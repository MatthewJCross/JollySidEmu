<ResourceDictionary x:Class="JollySidEmu.Styles.JollyWindowStyle"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:JollySidEmu.Styles" >
    <ControlTemplate x:Key="MainWindowTemplate" TargetType="{x:Type Window}">
        <ControlTemplate.Resources>
            <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
            <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <local:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>
        </ControlTemplate.Resources>
        <Border x:Name="RootBorder" Margin="0,0,0,10" BorderBrush="Black" BorderThickness="2,2,2,2" CornerRadius="10,10,0,0">
            <Border.Background>
                <LinearGradientBrush EndPoint="0.504,1.5" StartPoint="0.504,0.03">
                    <GradientStop Color="#FF7D8CE1" Offset="0"/>
                    <GradientStop Color="#FFEBF0F0" Offset="0.567"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid OpacityMask="#FFA80000">
                <Grid.RowDefinitions>
                    <RowDefinition Height="40"/> <!-- Title bar -->
                    <RowDefinition Height="Auto"/> <!-- Menu bar -->
                    <RowDefinition Height="*"/>  <!-- Content -->
                </Grid.RowDefinitions>
                <Border Margin="6,6,6,0" BorderBrush="Transparent" BorderThickness="0" CornerRadius="8,8,0,0" Background="#FFC9C997" HorizontalAlignment="Stretch" Grid.Row="0">
                    <Grid>
                        <DockPanel LastChildFill="False">
                            <Button Background="Transparent" BorderThickness="0" Command="{Binding IconClickCommand}" IsEnabled="{Binding IconClickable}" IsHitTestVisible="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IconClickable}">
                                <Image Width="40" Height="40" Margin="0,0,0,0" VerticalAlignment="Center" DockPanel.Dock="Left" Source="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Icon}" WindowChrome.IsHitTestVisibleInChrome="True">
                                <Image.ToolTip>
                                    <ToolTip Content="{Binding ToolTipText}" Visibility="{Binding ToolTipText, Converter={StaticResource StringToVisibilityConverter}}"/>
                                </Image.ToolTip>
                                </Image>
                            </Button>
                            <TextBlock Height="23" VerticalAlignment="Top" FontSize="18" FontWeight="Bold" Text="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Title}" Margin="10,4,0,0"/>
                            <Button x:Name="CloseButton" Margin="4,0,8,0" Click="OnCloseClick" DockPanel.Dock="Right" BorderThickness="0" Background="Transparent">
                                <Viewbox>
                                    <Canvas Width="32" Height="32" SnapsToDevicePixels="False" UseLayoutRounding="False">
                                        <Path Data="M 7.21875 5.78125 L 5.78125 7.21875 L 14.5625 16 L 5.78125 24.78125 L 7.21875 26.21875 L 16 17.4375 L 24.78125 26.21875 L 26.21875 24.78125 L 17.4375 16 L 26.21875 7.21875 L 24.78125 5.78125 L 16 14.5625 Z " Fill="{TemplateBinding Foreground}" />
                                    </Canvas>
                                </Viewbox>
                            </Button>
                            <Button x:Name="MaximizeRestoreButton" Margin="4,0,0,0" Click="OnMaximizeRestoreClick" DockPanel.Dock="Right" BorderThickness="0" Background="Transparent">
                                <Viewbox>
                                    <Canvas Width="32" Height="32" SnapsToDevicePixels="False" UseLayoutRounding="False">
                                        <Path Data="M24,8V24H8V8H24m2-2H6V26H26V6Z" Fill="{TemplateBinding Foreground}"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                            <Button x:Name="MinimizeButton" Margin="4,0,0,0" Click="OnMinimizeClick" DockPanel.Dock="Right" BorderThickness="0" Background="Transparent">
                                <Viewbox>
                                    <Canvas Width="32" Height="32" SnapsToDevicePixels="False" UseLayoutRounding="False">
                                        <Path Data="M26,26H6V24H26Z" Fill="{TemplateBinding Foreground}"/>
                                    </Canvas>
                                </Viewbox>
                            </Button>
                        </DockPanel>
                    </Grid>
                </Border>

                <Border x:Name="MenuBar" Grid.Row="1" Margin="6,0,6,0" Background="#FFC9C997" BorderBrush="Transparent" BorderThickness="0" CornerRadius="0,0,8,8" Visibility="{Binding IsMenuVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Menu Background="Transparent" BorderThickness="0" VerticalAlignment="Center" WindowChrome.IsHitTestVisibleInChrome="True">
                        <MenuItem Header="_File">
                            <MenuItem Header="_New" Command="{Binding NewCommand}" InputGestureText="Ctrl+N">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Canvas Width="16" Height="16">
                                            <!-- Paper outline -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="White" Data="M2,2 H14 V14 H2 Z" />
                                            <!-- Folded corner -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="LightGray" Data="M10,2 L14,2 L14,6 Z" />
                                        </Canvas>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Open" Command="{Binding OpenCommand}" InputGestureText="Ctrl+O">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Canvas Width="16" Height="16">
                                            <!-- Folder -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="Yellow" Data="M2,5 H6 L8,2 H14 V14 H2 Z" />
                                            <!-- Folder tab -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="Orange" Data="M2,5 H6 L8,2 H6 Z" />
                                        </Canvas>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Save" Command="{Binding SaveCommand}" InputGestureText="Ctrl+S">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Stroke="Black" StrokeThickness="1" Fill="Transparent" Data="M2,2 H14 V14 H2 Z M4,2 V6 H12 V2 M5,10 H11 V12 H5 Z"/>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Save As" Command="{Binding SaveAsCommand}" InputGestureText="Ctrl+Shift+S">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Canvas Width="16" Height="16">
                                            <!-- Floppy disk outline, same as Save -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="Transparent" Data="M2,2 H14 V14 H2 Z M4,2 V6 H12 V2 M5,10 H11 V12 H5 Z"/>
                                            <!-- Small pencil indicator -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="Orange" Data="M10,10 L12,12 L11,13 L9,11 Z"/>
                                            <Path Stroke="Black" StrokeThickness="1" Fill="Black"  Data="M12,12 L13,13 L12,14 L11,13 Z"/>
                                        </Canvas>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator/>
                            <MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGestureText="Ctrl+E">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Canvas Width="16" Height="16">
                                            <!-- Small rectangle with X -->
                                            <Path Stroke="Black" StrokeThickness="1" Fill="LightGray" Data="M2,2 H14 V14 H2 Z" />
                                            <Line X1="4" Y1="4" X2="12" Y2="12" Stroke="Red" StrokeThickness="1"/>
                                            <Line X1="4" Y1="12" X2="12" Y2="4" Stroke="Red" StrokeThickness="1"/>
                                        </Canvas>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>

                            <MenuItem Header="Recent Files" ItemsSource="{Binding RecentFiles}" IsEnabled="{Binding RecentFiles.Count, Converter={StaticResource GreaterThanZeroConverter}}">
                                <MenuItem.ItemTemplate>
                                    <DataTemplate>
                                        <MenuItem Header="{Binding FileName}" Command="{Binding DataContext.OpenRecentCommand, RelativeSource={RelativeSource AncestorType=Menu}}" CommandParameter="{Binding}"/>
                                    </DataTemplate>
                                </MenuItem.ItemTemplate>
                            </MenuItem>
                        </MenuItem>
                        
                        <MenuItem Header="_Edit">
                            <MenuItem Header="_Undo" Command="{Binding UndoCommand}" InputGestureText="Ctrl+Z">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Stroke="Black" StrokeThickness="1" Fill="Transparent" Data="M4,8 L8,4 L8,6 L12,6 L12,10 L8,10 L8,12 Z"/>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Header="_Redo" Command="{Binding RedoCommand}" InputGestureText="Ctrl+Y">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Path Stroke="Black" StrokeThickness="1" Fill="Transparent" Data="M12,8 L8,4 L8,6 L4,6 L4,10 L8,10 L8,12 Z"/>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>

                        <MenuItem Header="_Help">
                            <MenuItem Header="_About" Command="{Binding AboutCommand}" InputGestureText="Ctrl+A">
                                <MenuItem.Icon>
                                    <Viewbox Width="16" Height="16">
                                        <Canvas Width="16" Height="16">
                                            <Ellipse Stroke="Black" StrokeThickness="1" Fill="Transparent" Width="14" Height="14" Canvas.Left="1" Canvas.Top="1"/>
                                            <Rectangle Stroke="Black" Fill="Black" Width="1" Height="6" Canvas.Left="7.5" Canvas.Top="5"/>
                                            <Ellipse Stroke="Black" Fill="Black" Width="1" Height="1" Canvas.Left="7.5" Canvas.Top="3"/>
                                        </Canvas>
                                    </Viewbox>
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                    </Menu>
                </Border>
                
                <Grid Margin="6,2,6,6" Grid.Row="2">
                    <!--  Content  -->
                    <Border Background="#FFFFFFC9" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="8,8,0,0">
                        <AdornerDecorator>
                            <ContentPresenter />
                        </AdornerDecorator>
                    </Border>
                </Grid>

            </Grid>
        </Border>

        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True"/>
            <Trigger Property="Tag" Value="NoMenu">
                <Setter TargetName="MenuBar" Property="Visibility" Value="Collapsed"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style x:Key="JollyWindowStyle" TargetType="{x:Type Window}">
        <Style.Resources>
            <Style x:Key="FocusVisual">
                <Setter Property="Control.Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <Rectangle Margin="2" SnapsToDevicePixels="true" Stroke="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}" StrokeThickness="1" StrokeDashArray="1 2"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <SolidColorBrush x:Key="Button.Static.Background" Color="#FFDDDDDD"/>
            <SolidColorBrush x:Key="Button.Static.Border" Color="#FF707070"/>
            <SolidColorBrush x:Key="Button.MouseOver.Background" Color="#FFBEE6FD"/>
            <SolidColorBrush x:Key="Button.MouseOver.Border" Color="#FF3C7FB1"/>
            <SolidColorBrush x:Key="Button.Pressed.Background" Color="#FFC4E5F6"/>
            <SolidColorBrush x:Key="Button.Pressed.Border" Color="#FF2C628B"/>
            <SolidColorBrush x:Key="Button.Disabled.Background" Color="#FFF4F4F4"/>
            <SolidColorBrush x:Key="Button.Disabled.Border" Color="#FFADB2B5"/>
            <SolidColorBrush x:Key="Button.Disabled.Foreground" Color="#FF838383"/>
            <Style x:Key="ButtonStyle" TargetType="{x:Type Button}">
                <Setter Property="FocusVisualStyle" Value="{StaticResource FocusVisual}"/>
                <Setter Property="Background" Value="{StaticResource Button.Static.Background}"/>
                <Setter Property="BorderBrush" Value="{StaticResource Button.Static.Border}"/>
                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Padding" Value="1"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Button}">
                            <Border x:Name="border" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" SnapsToDevicePixels="true" CornerRadius="3">
                                <Border.Effect>
                                    <DropShadowEffect Color="Gray" Opacity=".50" ShadowDepth="8"/>
                                </Border.Effect>
                                <ContentPresenter x:Name="contentPresenter" Focusable="False" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsDefaulted" Value="true">
                                    <Setter Property="BorderBrush" TargetName="border" Value="{DynamicResource {x:Static SystemColors.HighlightBrushKey}}"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="true">
                                    <Setter Property="Background" TargetName="border" Value="{StaticResource Button.MouseOver.Background}"/>
                                    <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource Button.MouseOver.Border}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="true">
                                    <Setter Property="Background" TargetName="border" Value="{StaticResource Button.Pressed.Background}"/>
                                    <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource Button.Pressed.Border}"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="false">
                                    <Setter Property="Background" TargetName="border" Value="{StaticResource Button.Disabled.Background}"/>
                                    <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource Button.Disabled.Border}"/>
                                    <Setter Property="TextElement.Foreground" TargetName="contentPresenter" Value="{StaticResource Button.Disabled.Foreground}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                
            </Style>      
        </Style.Resources>

        <Setter Property="UseLayoutRounding" Value="True" />
        <Setter Property="TextOptions.TextFormattingMode" Value="Ideal" />
        <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        <Setter Property="WindowStyle" Value="None"/>
        <Setter Property="AllowsTransparency" Value="True"/>
        <Setter Property="WindowChrome.WindowChrome">
            <Setter.Value>
                <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" />
            </Setter.Value>
        </Setter>
        <Setter Property="Template" Value="{StaticResource MainWindowTemplate}" />
        <EventSetter Event="MouseDown" Handler="Window_MouseDown"/>
    </Style>

    <ControlTemplate x:Key="WindowButtonTemplate" TargetType="{x:Type Button}">
        <Grid Background="Transparent">
            <Border x:Name="MouseOverBorder" Background="#FFBEE6FD" Opacity="0" />
            <ContentPresenter x:Name="contentPresenter" Margin="{TemplateBinding Padding}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" />
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="MouseOverBorder" Property="Opacity" Value="1" />
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style x:Key="WindowButtonStyle" TargetType="{x:Type Button}">
        <Setter Property="Height" Value="24" />
        <Setter Property="Width" Value="24" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <!--<Setter Property="Foreground" Value="{theme:ThemeResource ResourceKey=WindowHeaderForeground}" />-->
        <Setter Property="Foreground" Value="Transparent" />
        <Setter Property="WindowChrome.IsHitTestVisibleInChrome" Value="True" />
        <Setter Property="VerticalAlignment" Value="Center" />
        <Setter Property="Padding" Value="4" />
        <Setter Property="Margin" Value="0" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Focusable" Value="False" />
        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        <Setter Property="Template" Value="{StaticResource WindowButtonTemplate}" />
        <Setter Property="BorderThickness" Value="0" />
    </Style>

    <Style TargetType="Menu">
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Foreground" Value="Black"/>
    </Style>

    <Style TargetType="MenuItem">
        <Setter Property="Padding" Value="10,4"/>
    </Style>
</ResourceDictionary>